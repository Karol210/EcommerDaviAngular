<p-dialog
  [header]="isLoginView() ? 'Iniciar Sesión' : 'Registro de Usuario'"
  [(visible)]="visible"
  [modal]="true"
  [closable]="true"
  [dismissableMask]="true"
  [draggable]="false"
  [resizable]="false"
  styleClass="auth-modal"
  [style]="{ width: isLoginView() ? '450px' : '600px' }">

  <!-- Vista de Login -->
  @if (isLoginView()) {
    <form [formGroup]="loginForm" (ngSubmit)="onLoginSubmit()" class="auth-form">
      <div class="form-field">
        <label for="email" class="form-label">Email</label>
        <input
          pInputText
          id="email"
          type="email"
          formControlName="email"
          placeholder="ejemplo@correo.com"
          class="form-input"
          [class.p-invalid]="loginForm.get('email')?.invalid && loginForm.get('email')?.touched" />
        @if (loginForm.get('email')?.invalid && loginForm.get('email')?.touched) {
          @if (loginForm.get('email')?.hasError('required')) {
            <small class="form-error">Este campo es requerido</small>
          }
          @if (loginForm.get('email')?.hasError('email')) {
            <small class="form-error">Email inválido</small>
          }
        }
      </div>

      <div class="form-field">
        <label for="password" class="form-label">Contraseña</label>
        <p-password
          formControlName="password"
          placeholder="Ingrese su contraseña"
          [toggleMask]="true"
          [feedback]="false"
          styleClass="form-input-password"
          [inputStyle]="{ width: '100%' }"
          inputId="password">
        </p-password>
        @if (loginForm.get('password')?.invalid && loginForm.get('password')?.touched) {
          @if (loginForm.get('password')?.hasError('required')) {
            <small class="form-error">Este campo es requerido</small>
          }
        }
      </div>

      <div class="form-actions">
        <p-button
          label="Iniciar Sesión"
          type="submit"
          [loading]="loading()"
          [disabled]="loading()"
          styleClass="form-submit-btn" />
      </div>

      <div class="form-footer">
        <a href="javascript:void(0)" (click)="switchToRegister()" class="form-link">
          ¿Quiero registrarme?
        </a>
      </div>
    </form>
  }

  <!-- Vista de Registro -->
  @else {
    <form [formGroup]="registerForm" (ngSubmit)="onRegisterSubmit()" class="auth-form register-form">
      <!-- Fila 1: Nombre y Apellido -->
      <div class="form-row">
        <div class="form-field">
          <label for="nombre" class="form-label">Nombre *</label>
          <input
            pInputText
            id="nombre"
            formControlName="nombre"
            placeholder="Ingrese su nombre"
            class="form-input"
            [class.p-invalid]="registerForm.get('nombre')?.invalid && registerForm.get('nombre')?.touched" />
          @if (registerForm.get('nombre')?.invalid && registerForm.get('nombre')?.touched) {
            @if (registerForm.get('nombre')?.hasError('required')) {
              <small class="form-error">Este campo es requerido</small>
            }
            @if (registerForm.get('nombre')?.hasError('minlength')) {
              <small class="form-error">Mínimo 2 caracteres</small>
            }
          }
        </div>

        <div class="form-field">
          <label for="apellido" class="form-label">Apellido *</label>
          <input
            pInputText
            id="apellido"
            formControlName="apellido"
            placeholder="Ingrese su apellido"
            class="form-input"
            [class.p-invalid]="registerForm.get('apellido')?.invalid && registerForm.get('apellido')?.touched" />
          @if (registerForm.get('apellido')?.invalid && registerForm.get('apellido')?.touched) {
            @if (registerForm.get('apellido')?.hasError('required')) {
              <small class="form-error">Este campo es requerido</small>
            }
            @if (registerForm.get('apellido')?.hasError('minlength')) {
              <small class="form-error">Mínimo 2 caracteres</small>
            }
          }
        </div>
      </div>

      <!-- Fila 2: Tipo de Documento y Número de Documento -->
      <div class="form-row">
        <div class="form-field">
          <label for="documentTypeId" class="form-label">Tipo de Documento *</label>
          <p-dropdown
            id="documentTypeId"
            formControlName="documentTypeId"
            [options]="documentTypes()"
            optionLabel="nombre"
            optionValue="documentoId"
            placeholder="Seleccione"
            [loading]="documentTypesLoading()"
            styleClass="form-input"
            [style]="{ width: '100%' }"
            [class.p-invalid]="registerForm.get('documentTypeId')?.invalid && registerForm.get('documentTypeId')?.touched">
          </p-dropdown>
          @if (registerForm.get('documentTypeId')?.invalid && registerForm.get('documentTypeId')?.touched) {
            @if (registerForm.get('documentTypeId')?.hasError('required')) {
              <small class="form-error">Debe seleccionar un tipo de documento</small>
            }
          }
        </div>

        <div class="form-field">
          <label for="documentNumber" class="form-label">Número de Documento *</label>
          <input
            pInputText
            id="documentNumber"
            formControlName="documentNumber"
            placeholder="Ingrese número"
            class="form-input"
            [class.p-invalid]="registerForm.get('documentNumber')?.invalid && registerForm.get('documentNumber')?.touched" />
          @if (registerForm.get('documentNumber')?.invalid && registerForm.get('documentNumber')?.touched) {
            @if (registerForm.get('documentNumber')?.hasError('required')) {
              <small class="form-error">Este campo es requerido</small>
            }
            @if (registerForm.get('documentNumber')?.hasError('pattern')) {
              <small class="form-error">Solo se permiten números</small>
            }
          }
        </div>
      </div>

      <!-- Fila 3: Email (ancho completo) -->
      <div class="form-field">
        <label for="email" class="form-label">Email *</label>
        <input
          pInputText
          id="email"
          type="email"
          formControlName="email"
          placeholder="ejemplo@correo.com"
          class="form-input"
          [class.p-invalid]="registerForm.get('email')?.invalid && registerForm.get('email')?.touched" />
        @if (registerForm.get('email')?.invalid && registerForm.get('email')?.touched) {
          @if (registerForm.get('email')?.hasError('required')) {
            <small class="form-error">Este campo es requerido</small>
          }
          @if (registerForm.get('email')?.hasError('email')) {
            <small class="form-error">Email inválido</small>
          }
        }
      </div>

      <!-- Fila 4: Contraseña (ancho completo) -->
      <div class="form-field">
        <label for="registerPassword" class="form-label">Contraseña *</label>
        <p-password
          formControlName="password"
          placeholder="Mínimo 8 caracteres"
          [toggleMask]="true"
          [feedback]="true"
          styleClass="form-input-password"
          [inputStyle]="{ width: '100%' }"
          inputId="registerPassword"
          promptLabel="Ingrese contraseña"
          weakLabel="Débil"
          mediumLabel="Media"
          strongLabel="Fuerte">
        </p-password>
        @if (registerForm.get('password')?.invalid && registerForm.get('password')?.touched) {
          @if (registerForm.get('password')?.hasError('required')) {
            <small class="form-error">Este campo es requerido</small>
          }
          @if (registerForm.get('password')?.hasError('minlength')) {
            <small class="form-error">Mínimo 8 caracteres</small>
          }
        }
      </div>

      <!-- Fila 5: Confirmar Contraseña (ancho completo) -->
      <div class="form-field">
        <label for="confirmPassword" class="form-label">Confirmar Contraseña *</label>
        <p-password
          formControlName="confirmPassword"
          placeholder="Confirme su contraseña"
          [toggleMask]="true"
          [feedback]="false"
          styleClass="form-input-password"
          [inputStyle]="{ width: '100%' }"
          inputId="confirmPassword">
        </p-password>
        @if (registerForm.get('confirmPassword')?.invalid && registerForm.get('confirmPassword')?.touched) {
          @if (registerForm.get('confirmPassword')?.hasError('required')) {
            <small class="form-error">Este campo es requerido</small>
          }
          @if (registerForm.get('confirmPassword')?.hasError('passwordMismatch')) {
            <small class="form-error">Las contraseñas no coinciden</small>
          }
        }
      </div>

      <div class="form-actions">
        <p-button
          label="Registrarse"
          type="submit"
          [loading]="loading()"
          [disabled]="loading()"
          styleClass="form-submit-btn" />
      </div>

      <div class="form-footer">
        <a href="javascript:void(0)" (click)="switchToLogin()" class="form-link">
          ¿Ya tienes cuenta? Inicia sesión
        </a>
      </div>
    </form>
  }
</p-dialog>

